//imagine reverse engineering banking app D: 
using System;
using System.Collections.Generic;
using System.Security.Cryptography;
using System.Text;

namespace banking_app_main
{
  class Program
  {
    public static List<Tuple<string, string, string, double>> users = new List<Tuple<string, string, string, double>>();
    static void Main(string[] args)
    {
        while(true)
        {
            Console.WriteLine("Welcome to Haxagon banking Aplication which is 100% secure.\n"); //Welcome message
            Console.WriteLine("To login into app write \"SIGNIN\" if you need make your own account write \"SIGNUP\""); //choose between SIGNIN and SIGNUP
            Console.Write("Enter option: ");
            string regOrSign = Console.ReadLine();

            if (regOrSign == "SIGNUP")
            {
                Console.Write("Please enter your username: ");
                string createUsername = Console.ReadLine();
                
                if (createUsername.Contains(" "))
                {
                    Console.WriteLine("Your password cannot contain space.");
                }
                Console.Write("Please enter your password: ");
                string createPassword = Console.ReadLine();
                Console.Write("Please enter your pin (4 digits): ");
                string createId = Console.ReadLine();

                bool isNumeric = Int32.TryParse(createPassword, out _);

                double startingAmmount = 0D;
                

                if (createId.Length == 4 && isNumeric)
                {
                    users.Add(Tuple.Create(Encrypt(createUsername), Encrypt(createPassword), createId, startingAmmount));
                } 
                
                else
                {
                    Console.WriteLine("Your pin contains text or length is'nt 4 digits");
                }
                

            }
            
            else if(regOrSign == "SIGNIN")
            {
                Console.Write("username: "); //print uname
                bool contains = false;
                var účet;
                string username = Console.ReadLine();
                foreach(var item in users)
                {
                    if(item[0] == Encrypt(username))
                    {
                        contains = true;
                        účet = item;
                    }
                }
                
                if(contains)
                {
                    Console.Write("password: "); //print pwd
                    string password = Console.ReadLine();
                    if(účet[1] == Encrypt(password))
                    {
                        Console.WriteLine("Loged in!");
                    }
                }
                
                else
                {
                    Console.WriteLine("User not found!");
                    Console.Beep();
                    
                    for(int i = 0; i<100; i++)
                    {
                        Console.Beep();
                    }   
                }
            }
      
            string komand = Console.ReadLine();
        
            if (komand == "needhelp") //pokud uživatel zadá needhelp vypíše se mu vzorový příkaz kterým jdou převést peníze mezi účty
            {
                Console.Write("Alice > Bob 100");
                Console.Write("from > to <amount>");
            }
      
            else if(komand.Split(" ")[1] == ">")
            {
                
                Prevod(komand.Split(" ")[0], komand.Split(" ")[2], Convert.ToDouble(komand.Split(" ")[3]));
            }  
            
            else if(komand.Split(" ")[0] == ">")
            {
                
                Prevod("none", komand.Split(" ")[1], Convert.ToDouble(komand.Split(" ")[2]));
            }
        }
    }
    
    static void Prevod(string from, string user, double ammount)
    {
        if(from != "none")
        {
            var ucet1 = users[0];
            foreach(var item in users)
                {
                    if(item.Item1 == from)
                    {
                        ucet1 = item;
                    }
                }
            
            users[users.IndexOf(ucet1)].Item4 -= ammount;
        }
        var ucet = users[0];
        foreach(var item in users)
                {
                    if(item.Item1 == user)
                    {
                        ucet = item;
                    }
                }

        users[users.IndexOf(ucet)].Item4 += ammount;
    }

    // Code by cisc0disco
    public static string Encrypt(string encryptText)
    {
        string result = "";
        MD5 md5 = MD5.Create();

        foreach (byte item in md5.ComputeHash(Encoding.ASCII.GetBytes(encryptText)))
        {
            result += item.ToString("X2").ToLower();
        }

        return result;
    }
  }
}
